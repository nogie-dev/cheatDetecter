# CTFd CheatDetecter Plugin

A powerful anti-cheating plugin for CTFd that detects and prevents flag sharing between users and teams during Capture The Flag competitions.

## üéØ Features

- **Real-time Flag Sharing Detection**: Automatically detects when flags are shared between different users or teams
- **Cross-team Cheating Prevention**: Identifies flag sharing between different teams in team mode
- **Individual Mode Support**: Works in both individual and team competition modes
- **Comprehensive Logging**: Records detailed information about cheating attempts including:
  - Username of the person who originally solved the challenge
  - Username of the person who used the shared flag
  - Team information for both users
  - IP address of the cheating attempt
  - Timestamp of the incident
  - Reason for the detection
- **Admin Dashboard**: Web-based interface for administrators to monitor cheating attempts
- **API Integration**: RESTful API for programmatic access to cheat detection data
- **Dynamic Flag Support**: Works with dynamic flags generated by container-based challenges

## üì∏ Screenshots & Logs

### Console Detection Logs
![Console Detection Logs](screenshots/console_detection.png)
*Real-time cheat detection logs in the console showing cross-team flag sharing attempts*

### Admin Dashboard
![Admin Dashboard](screenshots/dashboard_overview.png)
*Comprehensive admin dashboard displaying all detected cheating attempts with filtering capabilities*

### Detailed Cheat Logs
![Detailed Logs](screenshots/detailed_logs.png)
*Detailed view of cheating incidents including usernames, teams, IP addresses, and timestamps*

## üöÄ Installation

1. **Clone or Download**: Place the `cheatDetecter` folder in your CTFd `plugins` directory:
   ```
   CTFd/plugins/cheatDetecter/
   ```

2. **Database Migration**: The plugin will automatically create the necessary database tables when CTFd starts.

3. **Restart CTFd**: Restart your CTFd instance to load the plugin.

## üìã Requirements

- CTFd 3.0.0 or higher
- Python 3.7+
- Flask-SQLAlchemy
- Admin privileges for dashboard access

## üîß Configuration

The plugin is configured through `config.json`:

```json
{
    "name": "cheatDetector",
    "route": "/detecter/dashboard"
}
```

## üéÆ Usage

### For Administrators

1. **Access Dashboard**: Navigate to `/detecter/dashboard` in your CTFd admin panel
2. **View Cheating Attempts**: The dashboard displays all detected cheating attempts in a table format
3. **Filter Data**: Use the filter dropdowns to search by specific users or reasons
4. **API Access**: Use `/detecter/api/cheat_data` endpoint to programmatically access cheat detection data

### Dashboard Features

- **Real-time Updates**: Data is fetched via AJAX for real-time updates
- **Filtering**: Filter by username or cheating reason
- **Timestamp Formatting**: Human-readable timestamps for all incidents
- **Responsive Design**: Works on desktop and mobile devices

### API Endpoints

#### GET `/detecter/api/cheat_data`
Returns JSON data of all cheating attempts:

```json
[
    {
        "shared_username": "user_who_used_flag",
        "sharer_username": "user_who_solved_challenge",
        "shared_team": "team_of_user_who_used_flag",
        "sharer_team": "team_of_user_who_solved_challenge",
        "cheat_ip": "192.168.1.100",
        "timestamp": 1640995200,
        "reason": "Cross Team Flag Sharing"
    }
]
```

## üîç How It Works

### Detection Algorithm

1. **Flag Submission**: When a user submits a flag, the plugin intercepts the submission
2. **Database Lookup**: Checks if the submitted flag exists in the `DynamicFlag` table
3. **User Comparison**: Compares the current user with the original solver
4. **Team Verification**: In team mode, verifies if users belong to different teams
5. **Cheat Logging**: If cheating is detected, logs the incident and blocks the submission

### Database Schema

#### DynamicFlag Table
- `id`: Primary key
- `created_flag`: The flag that was generated
- `container_id`: Associated container ID (for container-based challenges)
- `challenge_id`: Challenge ID
- `team_id`: Team ID (nullable for individual mode)
- `user_id`: User ID of the original solver
- `user_ip`: IP address of the original solver

#### cheatList Table
- `id`: Primary key
- `shared_username`: Username of the person who used the shared flag
- `sharer_username`: Username of the person who originally solved the challenge
- `shared_team`: Team name of the person who used the shared flag
- `sharer_team`: Team name of the person who originally solved the challenge
- `cheat_ip`: IP address of the cheating attempt
- `timestamp`: Unix timestamp of the incident
- `reason`: Description of the cheating type

## üõ°Ô∏è Security Features

- **IP Tracking**: Records IP addresses for both original solvers and cheating attempts
- **Team Isolation**: Prevents cross-team flag sharing in team competitions
- **Individual Protection**: Detects flag sharing in individual competitions
- **Admin-only Access**: Dashboard and API access restricted to administrators
- **Audit Trail**: Complete logging of all cheating attempts for investigation

## üîß Integration with Other Plugins

The cheatDetecter plugin integrates seamlessly with:
- **Container Plugin**: Works with dynamic flags generated by container-based challenges
- **Dynamic Challenges Plugin**: Compatible with dynamic challenge types
- **Team Management**: Supports both individual and team competition modes

## üêõ Troubleshooting

### Common Issues

1. **Plugin Not Loading**: Ensure the plugin folder is in the correct location and CTFd has been restarted
2. **Dashboard Not Accessible**: Verify you have admin privileges
3. **Database Errors**: Check that CTFd has proper database permissions
4. **False Positives**: Review the detection logic if legitimate flag sharing is being flagged

### Debug Mode

Enable CTFd debug mode to see detailed plugin loading information:
```python
# In CTFd config
DEBUG = True
```

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## üìÑ License

This plugin is released under the same license as CTFd.

## üÜò Support

For issues and questions:
1. Check the troubleshooting section above
2. Review CTFd documentation
3. Open an issue on the repository
4. Contact the plugin maintainer

## üîÑ Version History

- **v1.0.0**: Initial release with basic cheat detection
- **v1.1.0**: Added admin dashboard and API endpoints
- **v1.2.0**: Enhanced filtering and UI improvements
- **v1.3.0**: Added support for dynamic flags and container integration

---

**Note**: This plugin is designed to help maintain fair play in CTF competitions. Use responsibly and ensure your competition rules are clearly communicated to participants.
